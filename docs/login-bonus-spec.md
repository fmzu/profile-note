# Login Bonus Specification

## Background

プロフィール帳アプリの姉妹機能として、平日のセルフケアを支援するログインボーナス体験を追加する。ユーザーが自分自身に小さなご褒美メッセージを贈ることで、出勤・登校日のモチベーション維持をサポートする。

## Content

### ターゲットと目的
- 平日に出勤または学校がある利用者が、1週間を通して自分の機嫌をとるために使う。
- アプリ内で得られる報酬は言葉のみとし、自己肯定感を高めることを主眼とする。

### タイムラインとログイン判定
- タイムゾーンは日本時間（JST）。日付境界は午前0時。
- 週の開始は通常月曜日。月曜が日本の祝日の場合は火曜開始。終了日は開始日から5営業日目だが、金曜が祝日の場合は木曜が終了日など、土日前に連続する祝日をスキップする。
- 祝日判定は npm パッケージ `japanese-holidays` を利用してローカルで行う。ネットワーク不要で将来の祝日追加にも追随しやすい。
- アプリ起動時に自動で「ログイン」扱いとする。ログイン操作ボタンは不要。

### 連続ログインとボーナス付与
- 対象日は当週の平日のみ（祝日を除外）。土日はカウントに含めない。
- 平日連続5日ログインで、その週の終了日にボーナスメッセージを表示して「ログインボーナス（ユーザーが設定したテキスト）」を付与する。
- 連続ログインを崩した場合でも、終了日に表示される「ログインボーナスをゲットしますか？」ボタンから手動でボーナス画面へ遷移できる。これは自己ケアの一環で、ユーザーが自分に優しくするための救済措置。
- 土日はログインボーナス進行に影響しないが、アプリ起動で激励メッセージのみ表示する。
- 前週のログイン結果は保持するが、過去週のボーナス編集は不可。

### ボーナス設定ルール
- 各週にユーザーがテキストで「ログインボーナス」を設定できる。絵文字など任意文字列を想定。
- ボーナスはその週の付与日（通常金曜 or 祝日により前倒し）以外のタイミングで自由に編集可能。
- 過去の週のボーナスは読み取り専用。未来は3か月先まで設定可能。
- 初回起動時や未設定週へ入った際は「今週のログインボーナスを設定しましょう」ガイドを表示して設定フォームへ誘導する。

### メッセージ仕様
- 平日通常ログイン時：例「ログインお疲れ様！」「今日も一日がんばろう！」固定文をローテーション表示。
- ボーナス達成時：例「一週間お疲れ様！」「ログインボーナスゲット！『◯◯』」。
- 土日ログイン時：例「ゆっくり休んでね」「また一週間がんばろう」。
- 週末にボーナス未設定のまま終了した場合：「ログインボーナスゲット！今週のログインボーナスは今日のあなたが決めよう！」などリマインド。

### UI要件（スマホファースト）
- スクロールなしで収まる1画面構成。
- コンポーネント構成：
  1. **Weekly Calendar**：月〜金（祝日補正）のグリッド。ログイン済み日は💮スタンプ。未ログイン日は淡色。祝日はリボン表示でスキップ視覚化。
  2. **Message Panel**：当日のメッセージと、進捗サマリー（連続日数・残り日数）。
  3. **Bonus Editor**：当週のボーナス表示と編集ボタン。初回 or 未設定時はフォームを展開してテキスト入力。終了日に手動ゲット案内ボタンを条件表示。
- プロフィール帳と同系の淡いパステルカラーを踏襲。

### データ保持と状態
- 状態は React + Zustand（既存 store パターン）を再利用予定。
- ローカルストレージへ以下データを保存：
  - 各週のログイン履歴（ISO 日付キー、true/false）。
  - 各週のボーナステキスト。
  - 週ID（開始日 ISO）ごとのステータス（達成済み/未達/手動付与）。
- 初期データとして未ログイン扱いを生成し、当日が対象期間内かを確認して更新する。
- 将来の API 連携を見越して、リポジトリ構造は `/routes/login-bonus` + `/store/login-bonus-context.ts` + `/types/login-bonus.ts` で分離する。

## Decisions

- 祝日判定は `japanese-holidays` パッケージで実装し、オフラインでも正しい週分割ができるようにする。
- データは当面ローカルストレージのみ。API 連携のインターフェイスは後続タスクで追加する。
- UI はスマホ前提の 1 ビュー構成とし、後日デスクトップ対応を検討する。

## Action Items

1. 祝日対応の週ユーティリティを実装（JST カレンダー計算）。
2. ログインボーナス用 Zustand ストアと localStorage 同期レイヤーを作成。
3. `/routes/login-bonus` に UI（カレンダー、メッセージ、ボーナス編集）を実装。
4. 固定メッセージ辞書とローテーションロジックを追加。
